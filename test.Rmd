---
title: "EC4308 Project"
author: "Josiah Lee, Riley Teo, Steffi Lum"
date: "`r Sys.Date()`"
output: html_document
---



### Read in the Data
<!-- install.packages("devtools") -->
<!-- install_github(gabrielrvsc/HDeconometrics) -->

library(HDeconometrics)
library(conflicted)
library(readxl)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(tsibble)
library(purrr)
library(tseries)
library(car)
library(leaps)
library(tictoc)
library(sandwich) 
library(randomForest)
library(hdm)
library(glmnet)
library(pls)
library(xgboost)
library(reshape2)

set.seed(4308)

source("01-eda.R")

### Model for 1 step
ntest = 247
source("02-predicting 1-step.R")

#Further Analysis on the excessive Profitability
source("plotting.R")
plot_signal_timing(yy, lm_AIC$pred[, 1])
plot_signal_timing(yy, lasso_test$pred[, 1])
plot_signal_timing(yy, EN_test$pred[, 1])

dev.off()


results_1step = model_results

pred_1 = all_preds

#testing for different section of test data cos got oo much positives
ntest =  120
d = data
data = data[1:(nrow(data)-247),, ]
source("02-predicting 1-step.R")

results_1step_alt = model_results
#model for 2 step
data = d %>% arrange(yyyymm) %>% mutate(ep=lead(ep), yyyymm = lead(yyyymm)) %>% na.omit()

#make sure to check for AIC and BIC for subset selection to see if the iterative process is the same
ntest = 247
source("02-predicting 1-step.R")

results_2step = model_results

pred_2 = all_preds

#model for 3 step
data = data %>% arrange(yyyymm) %>% mutate(ep=lead(ep), yyyymm = lead(yyyymm)) %>% na.omit()

#make sure to check for AIC and BIC for subset selection to see if the iterative process is the same
source("02-predicting 1-step.R")

results_3step = model_results

pred_3 = all_preds

preds = pred_1 +pred_2+pred_3

PT = c()
for (i in 1:13) {
  PT = c(PT, PT_test(preds[, i], yy))
}

# HM test for comparison with t+3
PT

#model for 6 step
data = data %>% arrange(yyyymm) %>% mutate(ep=lead(ep, 3), yyyymm = lead(yyyymm, 3)) %>% na.omit()

#make sure to check for AIC and BIC for subset selection to see if the iterative process is the same
source("02-predicting 1-step.R")

results_6step = model_results

#model for 12 step
data = data %>% arrange(yyyymm) %>% mutate(ep=lead(ep, 6), yyyymm = lead(yyyymm, 6)) %>% na.omit()

#make sure to check for AIC and BIC for subset selection to see if the iterative process is the same
source("02-predicting 1-step.R")

results_12step = model_results